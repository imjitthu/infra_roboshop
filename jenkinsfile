pipeline {

    agent any

    stages ('Installing RoboShop WebApplication Components') {
        stage ('Installing Databases') {
            parallel {
                stage ('Installing MongoDB') {
                    steps {
                        dir ('mongo') {
                        withCredentials([aws(accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'awskey', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY')]) {
                        git 'https://github.com/imjitthu/tfas-mongo.git'
                        sh """
                        terraform init
                        """
                        } 
                        sh 'ls; pwd'
                        ansiblePlaybook credentialsId: 'DevOps321', installation: 'ansibletool', inventory: 'mongo_inv', playbook: 'mongo.yml'
                    }
                    }
                }
                stage ('Installing MySQL') {
                    steps {
                        dir ('mysql') {
                        withCredentials([aws(accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'awskey', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY')]) {
                        git 'https://github.com/imjitthu/tfas-mysql.git'
                        sh """
                        terraform init
                        """
                        } 
                        sh 'ls; pwd'
                        ansiblePlaybook credentialsId: 'DevOps321', installation: 'ansibletool', inventory: 'mysql_inv', playbook: 'mysql.yml'
                    }
                    }
                }
            }
        }
        stage ('Installing Redis and Redis Server') {
            parallel {
                stage ('Installing Redis Component') {
                    steps {
                        dir('redis') {
                        withCredentials([aws(accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'awskey', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY')]) {
                        git 'https://github.com/imjitthu/tfas-redis.git'
                        sh """
                        terraform init
                        """
                        } 
                        sh 'ls; pwd'
                        ansiblePlaybook credentialsId: 'DevOps321', installation: 'ansibletool', inventory: 'redis_inv', playbook: 'redis.yml'
                    }
                    }
                }
                stage ('Installing RabbitmQ Server') {
                    steps {
                        dir('rabbitmq') {
                        withCredentials([aws(accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'awskey', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY')]) {
                        git 'https://github.com/imjitthu/tfas-rabbitmq.git'
                        sh """
                        terraform init
                        """
                        } 
                        sh 'ls; pwd'
                        ansiblePlaybook credentialsId: 'DevOps321', installation: 'ansibletool', inventory: 'rabbitmq_inv', playbook: 'rabbitmq.yml'
                            }
                        }
                    }
                }
            }
        stage ('Installing Components: CART, CATALOGUE, USER, SGIPPING, PAYMENT') {
            parallel {
                stage ('Installing CART Component') {
                    steps {
                        sh 'echo CART'
                    }
                }
                stage ('Installing CATALOGUE Component') {
                    steps {
                        sh 'echo CATALOGUE'
                    }
                }
                stage ('Installing USER Component') {
                    steps {
                        sh 'echo USER'
                    }
                }
                stage ('Installing SHIPPING Component') {
                    steps {
                        sh 'echo Shipping'
                    }
                }
                stage ('Installing Payment Component') {
                    steps {
                        sh 'echo Payment'
                    }
                }
            }
        }
        stage ('Installing Roboshop Web Server') {
            steps {
                sh 'echo web Server'
                }
            }
        }
    }